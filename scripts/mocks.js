function MockStormpath(){function a(){return Math.floor(1e4*Math.random())}function b(b){return{appHref:b,csrfToken:a(),hpValue:a(),expires:(new Date).getTime()+3e5}}function c(b,c){var d={href:b,loginAttempts:{href:b+"/loginAttempts"},accounts:{href:b+"/accounts"},passwordResetTokens:{href:b+"/passwordResetTokens"},csrfToken:a(),hpValue:a(),expires:(new Date).getTime()+3e5};c.respond(200,{"Content-Type":"application/json"},JSON.stringify(d))}function d(b,c){var d={account:{href:b},redirectTo:"https://stormpath.com",csrfToken:a(),hpValue:a(),expires:(new Date).getTime()+3e5};c.respond(200,{"Content-Type":"application/json"},JSON.stringify(d))}function e(b){var c={status:400,code:400,message:"Invalid username or password.",developerMessage:"Invalid username or password.",moreInfo:"mailto:support@stormpath.com",csrfToken:a(),hpValue:a(),expires:(new Date).getTime()+3e5};b.respond(400,{"Content-Type":"application/json"},JSON.stringify(c))}function f(b){var c={status:404,code:404,message:"The requested resource does not exist.",developerMessage:"The requested resource does not exist.",moreInfo:"mailto:support@stormpath.com",csrfToken:a(),hpValue:a(),expires:(new Date).getTime()+3e5};b.respond(404,{"Content-Type":"application/json"},JSON.stringify(c))}function g(b,c,d){var e=a(),f={href:"https://api.stormpath.com/v1/accounts/"+e,username:b.username,email:b.email||b.username,fullName:b.givenName+" "+b.surname,givenName:b.givenName,middleName:"",surname:b.surname,status:c?"VERIFIED":"UNVERIFIED",customData:{href:"https://api.stormpath.com/v1/accounts/"+e+"/customData"},groups:{href:"https://api.stormpath.com/v1/accounts/"+e+"/groups"},groupMemberships:{href:"https://api.stormpath.com/v1/accounts/"+e+"/groupMemberships"},directory:{href:"https://api.stormpath.com/v1/directories/"+a()},tenant:{href:"https://api.stormpath.com/v1/tenants/"+a()},emailVerificationToken:{href:"https://api.stormpath.com/v1/accounts/emailVerificationTokens/"+a()},csrfToken:a(),hpValue:a(),expires:(new Date).getTime()+3e5};c&&(f.redirectTo="https://stormpath.com"),d.respond(201,{"Content-Type":"application/json"},JSON.stringify(f))}function h(b){var c={status:409,code:2001,userMessage:"Account with that username already exists.  Please choose another username.",developerMessage:"Account with that username already exists.  Please choose another username.",moreInfo:"http://docs.stormpath.com/errors/2001",message:"HTTP 409, Stormpath 2001 (http://docs.stormpath.com/errors/2001): Account with that username already exists.  Please choose another username.",csrfToken:a(),hpValue:a(),expires:(new Date).getTime()+3e5};b.respond(409,{"Content-Type":"application/json"},JSON.stringify(c))}function i(b){var c={status:499,code:499,userMessage:"Something bad happened, and I'm telling you about it",csrfToken:a(),hpValue:a(),expires:(new Date).getTime()+3e5};b.respond(499,{"Content-Type":"application/json"},JSON.stringify(c))}function j(b){var c={status:400,code:2007,userMessage:"Account password minimum length not satisfied.",developerMessage:"Account password minimum length not satisfied.",moreInfo:"http://docs.stormpath.com/errors/2007",message:"HTTP 400, Stormpath 2007 (http://docs.stormpath.com/errors/2007): Account password minimum length not satisfied.",csrfToken:a(),hpValue:a(),expires:(new Date).getTime()+3e5};b.respond(c.status,{"Content-Type":"application/json"},JSON.stringify(c))}function k(b){var c={status:400,code:400,userMessage:"Password requires an uppercase character!",developerMessage:"Password requires an uppercase character!",moreInfo:"mailto:support@stormpath.com",message:"HTTP 400, Stormpath 400 (mailto:support@stormpath.com): Password requires an uppercase character!",csrfToken:a(),hpValue:a(),expires:(new Date).getTime()+3e5};b.respond(c.status,{"Content-Type":"application/json"},JSON.stringify(c))}function l(b){var c={status:400,code:400,userMessage:"Password requires a numeric character!",developerMessage:"Password requires a numeric character!",moreInfo:"mailto:support@stormpath.com",message:"HTTP 400, Stormpath 400 (mailto:support@stormpath.com): Password requires a numeric character!",csrfToken:a(),hpValue:a(),expires:(new Date).getTime()+3e5};b.respond(c.status,{"Content-Type":"application/json"},JSON.stringify(c))}function m(b,c){var d={status:200,code:200,href:"https://api.stormpath.com/v1/applications/1h72PFWoGxHKhysKjYIkir/passwordResetTokens/QnKDpz3jxWYrnX9UzOStjgR5S6XBLyhEHRaUgpnKUUrb8GqWWGxcYC8CjcBCchKO3n0quuAZe9",email:"robert@robertjd.com",account:{href:"https://api.stormpath.com/v1/accounts/"+a()},csrfToken:a(),hpValue:a(),expires:(new Date).getTime()+3e5};c.respond(d.status,{"Content-Type":"application/json"},JSON.stringify(d))}var n=window.sinon,o=n.fakeServer.create();return o.respondWith("POST","https://api.stormpath.com/v1/applications/1234/csrfToken",function(a){console.log("TOKEN REQUEST"),a.respond(200,{"Content-Type":"application/json"},JSON.stringify(new b("/v1/applications/1234/")))}),o.respondWith("POST","https://api.stormpath.com/v1/applications/1234/loginAttempts?expand=account",function(a){console.log(a.requestBody);var b='{"type":"basic","value":"cm9iZXJ0QHN0b3JtcGF0aC5jb206cm9iZXJ0QHN0b3JtcGF0aC5jb20="}',c='{"type":"basic","value":"cm9iZXJ0QHN0b3JtcGF0aC5jb206MQ=="}',g='{"type":"basic","value":"NDk5OjQ5OQ=="}';a.requestBody===b?d("https://api.stormpath.com/v1/applications/1234",a):a.requestBody===c?e(a):a.requestBody===g?i(a):f(a)}),o.respondWith("POST","https://api.stormpath.com/v1/applications/1234/accounts",function(a){var b=JSON.parse(a.requestBody),c=b.password;if(a.requestBody.match(/stormpath/))h(a);else if(c&&1===c.length)j(a);else if(c&&!c.match(/[A-Z]+/))k(a);else if(c&&!c.match(/[0-9]+/))l(a);else if(a.requestBody.match(/499/))i(a);else{var d=null!==a.requestBody.match(/verified|google|facebook/);g(JSON.parse(a.requestBody),d,a)}}),o.respondWith("GET","https://api.stormpath.com/v1/applications/1234",function(a){c("https://api.stormpath.com/v1/applications/1234",a)}),o.respondWith("GET","https://api.stormpath.com/v1/tenants/current",function(a){var b=Math.floor(1e5*Math.random());a.respond(200,{"Content-Type":"application/json"},JSON.stringify({href:"https://api.stormpath.com/v1/tenants/"+b}))}),o.respondWith("POST","https://api.stormpath.com/v1/accounts/emailVerificationTokens/1",function(a){g({email:"joe@somebody.com"},!0,a)}),o.respondWith("POST","https://api.stormpath.com/v1/accounts/emailVerificationTokens/2",function(a){f(a)}),o.respondWith("POST","https://api.stormpath.com/v1/accounts/emailVerificationTokens/3",function(a){i(a)}),o.respondWith("GET","https://api.stormpath.com/v1/applications/1234/passwordResetTokens/1",function(a){g({email:"joe@somebody.com"},!0,a)}),o.respondWith("GET","https://api.stormpath.com/v1/applications/1234/passwordResetTokens/2",function(a){f(a)}),o.respondWith("GET","https://api.stormpath.com/v1/applications/1234/passwordResetTokens/3",function(a){i(a)}),o.respondWith("POST","https://api.stormpath.com/v1/applications/1234/passwordResetTokens",function(a){var b=JSON.parse(a.requestBody);b.email.match(/robert@stormpath.com/)?m(b.email,a):b.email.match(/499/)?i(a):f(a)}),o.respondWith("POST",new RegExp("https://api.stormpath.com/v1/accounts/[0-9]+$"),function(a){var b=JSON.parse(a.requestBody);1===b.password.length?j(a):b.password.match(/[A-Z]+/)?b.password.match(/[0-9]+/)?a.requestBody.match(/499/)?i(a):g(JSON.parse(a.requestBody),!0,a):l(a):k(a)}),o.autoRespond=!0,o.autoRespondAfter=200,o}this.sinon=function(){function define(a,b,c){"samsam"==a?samsam=b():formatio=c(samsam)}var samsam,formatio;define.amd=!0,("function"==typeof define&&define.amd&&function(a){define("samsam",a)}||"object"==typeof module&&function(a){module.exports=a()}||function(a){this.samsam=a()})(function(){function a(a){var b=a;return"number"==typeof a&&a!==b}function b(a){return l.toString.call(a).split(/[ \]]/)[1]}function c(a){if("object"!=typeof a||"number"!=typeof a.length||"Array"===b(a))return!1;if("function"==typeof a.callee)return!0;try{a[a.length]=6,delete a[a.length]}catch(c){return!0}return!1}function d(a){if(!a||1!==a.nodeType||!m)return!1;try{a.appendChild(m),a.removeChild(m)}catch(b){return!1}return!0}function e(a){var b,c=[];for(b in a)l.hasOwnProperty.call(a,b)&&c.push(b);return c}function f(a){return"function"==typeof a.getTime&&a.getTime()==a.valueOf()}function g(a){return 0===a&&1/a===-1/0}function h(b,c){return b===c||a(b)&&a(c)?0!==b||g(b)===g(c):void 0}function i(g,i){function j(a){return"object"!=typeof a||null===a||a instanceof Boolean||a instanceof Date||a instanceof Number||a instanceof RegExp||a instanceof String?!1:!0}function k(a,b){var c;for(c=0;c<a.length;c++)if(a[c]===b)return c;return-1}var m=[],n=[],o=[],p=[],q={};return function r(g,i,s,t){var u=typeof g,v=typeof i;if(g===i||a(g)||a(i)||null==g||null==i||"object"!==u||"object"!==v)return h(g,i);if(d(g)||d(i))return!1;var w=f(g),x=f(i);if(!(!w&&!x||w&&x&&g.getTime()===i.getTime()))return!1;if(g instanceof RegExp&&i instanceof RegExp&&g.toString()!==i.toString())return!1;var y=b(g),z=b(i),A=e(g),B=e(i);if(c(g)||c(i)){if(g.length!==i.length)return!1}else if(u!==v||y!==z||A.length!==B.length)return!1;var C,D,E,F,G,H,I,J,K,L,M;for(D=0,E=A.length;E>D;D++){if(C=A[D],!l.hasOwnProperty.call(i,C))return!1;if(F=g[C],G=i[C],H=j(F),I=j(G),J=H?k(m,F):-1,K=I?k(n,G):-1,L=-1!==J?o[J]:s+"["+JSON.stringify(C)+"]",M=-1!==K?p[K]:t+"["+JSON.stringify(C)+"]",q[L+M])return!0;if(-1===J&&H&&(m.push(F),o.push(L)),-1===K&&I&&(n.push(G),p.push(M)),H&&I&&(q[L+M]=!0),!r(F,G,L,M))return!1}return!0}(g,i,"$1","$2")}function j(a,b){if(0===b.length)return!0;var c,d,e,f;for(c=0,d=a.length;d>c;++c)if(k(a[c],b[0])){for(e=0,f=b.length;f>e;++e)if(!k(a[c+e],b[e]))return!1;return!0}return!1}var k,l=Object.prototype,m="undefined"!=typeof document&&document.createElement("div");return k=function n(a,c){if(c&&"function"==typeof c.test)return c.test(a);if("function"==typeof c)return c(a)===!0;if("string"==typeof c){c=c.toLowerCase();var d="string"==typeof a||!!a;return d&&String(a).toLowerCase().indexOf(c)>=0}if("number"==typeof c)return c===a;if("boolean"==typeof c)return c===a;if("Array"===b(a)&&"Array"===b(c))return j(a,c);if(c&&"object"==typeof c){var e;for(e in c)if(!n(a[e],c[e]))return!1;return!0}throw new Error("Matcher was not a string, a number, a function, a boolean or an object")},{isArguments:c,isElement:d,isDate:f,isNegZero:g,identical:h,deepEqual:i,match:k,keys:e}}),("function"==typeof define&&define.amd&&function(a){define("formatio",["samsam"],a)}||"object"==typeof module&&function(a){module.exports=a(require("samsam"))}||function(a){this.formatio=a(this.samsam)})(function(a){function b(a){if(!a)return"";if(a.displayName)return a.displayName;if(a.name)return a.name;var b=a.toString().match(/function\s+([^\(]+)/m);return b&&b[1]||""}function c(a,c){var d,e,f=b(c&&c.constructor),h=a.excludeConstructors||g.excludeConstructors||[];for(d=0,e=h.length;e>d;++d){if("string"==typeof h[d]&&h[d]===f)return"";if(h[d].test&&h[d].test(f))return""}return f}function d(a,b){if("object"!=typeof a)return!1;var c,d;for(c=0,d=b.length;d>c;++c)if(b[c]===a)return!0;return!1}function e(b,c,f,g){if("string"==typeof c){var i=b.quoteStrings,j="boolean"!=typeof i||i;return f||j?'"'+c+'"':c}if("function"==typeof c&&!(c instanceof RegExp))return e.func(c);if(f=f||[],d(c,f))return"[Circular]";if("[object Array]"===Object.prototype.toString.call(c))return e.array.call(b,c,f);if(!c)return String(1/c===-1/0?"-0":c);if(a.isElement(c))return e.element(c);if("function"==typeof c.toString&&c.toString!==Object.prototype.toString)return c.toString();var k,l;for(k=0,l=h.length;l>k;k++)if(c===h[k].object)return h[k].value;return e.object.call(b,c,f,g)}function f(a){for(var b in a)this[b]=a[b]}var g={excludeConstructors:["Object",/^.$/],quoteStrings:!0},h=(Object.prototype.hasOwnProperty,[]);return"undefined"!=typeof global&&h.push({object:global,value:"[object global]"}),"undefined"!=typeof document&&h.push({object:document,value:"[object HTMLDocument]"}),"undefined"!=typeof window&&h.push({object:window,value:"[object Window]"}),e.func=function(a){return"function "+b(a)+"() {}"},e.array=function(a,b){b=b||[],b.push(a);var c,d,f=[];for(c=0,d=a.length;d>c;++c)f.push(e(this,a[c],b));return"["+f.join(", ")+"]"},e.object=function(b,f,g){f=f||[],f.push(b),g=g||0;var h,i,j,k,l,m=[],n=a.keys(b).sort(),o=3;for(k=0,l=n.length;l>k;++k)h=n[k],j=b[h],i=d(j,f)?"[Circular]":e(this,j,f,g+2),i=(/\s/.test(h)?'"'+h+'"':h)+": "+i,o+=i.length,m.push(i);var p=c(this,b),q=p?"["+p+"] ":"",r="";for(k=0,l=g;l>k;++k)r+=" ";return o+g>80?q+"{\n  "+r+m.join(",\n  "+r)+"\n"+r+"}":q+"{ "+m.join(", ")+" }"},e.element=function(a){var b,c,d,e,f,g=a.tagName.toLowerCase(),h=a.attributes,i=[];for(d=0,e=h.length;e>d;++d)b=h.item(d),c=b.nodeName.toLowerCase().replace("html:",""),f=b.nodeValue,("contenteditable"!==c||"inherit"!==f)&&f&&i.push(c+'="'+f+'"');var j="<"+g+(i.length>0?" ":""),k=a.innerHTML;k.length>20&&(k=k.substr(0,20)+"[...]");var l=j+i.join(" ")+">"+k+"</"+g+">";return l.replace(/ contentEditable="inherit"/,"")},f.prototype={functionName:b,configure:function(a){return new f(a)},constructorName:function(a){return c(this,a)},ascii:function(a,b,c){return e(this,a,b,c)}},f.prototype});var sinon=function(a){function b(a){var b=!1;try{a.appendChild(h),b=h.parentNode==a}catch(c){return!1}finally{try{a.removeChild(h)}catch(c){}}return b}function c(a){return h&&a&&1===a.nodeType&&b(a)}function d(a){return"function"==typeof a||!!(a&&a.constructor&&a.call&&a.apply)}function e(a){return"number"==typeof a&&isNaN(a)}function f(a,b){for(var c in b)i.call(a,c)||(a[c]=b[c])}function g(a){return"function"==typeof a&&"function"==typeof a.restore&&a.restore.sinon}var h="undefined"!=typeof document&&document.createElement("div"),i=Object.prototype.hasOwnProperty,j={wrapMethod:function(a,b,c){if(!a)throw new TypeError("Should wrap property of object");if("function"!=typeof c)throw new TypeError("Method wrapper should be function");var e,g=a[b];if(d(g)||(e=new TypeError("Attempted to wrap "+typeof g+" property "+b+" as function")),g.restore&&g.restore.sinon&&(e=new TypeError("Attempted to wrap "+b+" which is already wrapped")),g.calledBefore){var h=g.returns?"stubbed":"spied on";e=new TypeError("Attempted to wrap "+b+" which is already "+h)}if(e)throw g._stack&&(e.stack+="\n--------------\n"+g._stack),e;var j=a.hasOwnProperty?a.hasOwnProperty(b):i.call(a,b);return a[b]=c,c.displayName=b,c._stack=new Error("Stack Trace for original").stack,c.restore=function(){j||delete a[b],a[b]===c&&(a[b]=g)},c.restore.sinon=!0,f(c,g),c},extend:function(a){for(var b=1,c=arguments.length;c>b;b+=1)for(var d in arguments[b])arguments[b].hasOwnProperty(d)&&(a[d]=arguments[b][d]),arguments[b].hasOwnProperty("toString")&&arguments[b].toString!=a.toString&&(a.toString=arguments[b].toString);return a},create:function(a){var b=function(){};return b.prototype=a,new b},deepEqual:function p(a,b){if(j.match&&j.match.isMatcher(a))return a.test(b);if("object"!=typeof a||"object"!=typeof b)return e(a)&&e(b)?!0:a===b;if(c(a)||c(b))return a===b;if(a===b)return!0;if(null===a&&null!==b||null!==a&&null===b)return!1;if(a instanceof RegExp&&b instanceof RegExp)return a.source===b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline;var d=Object.prototype.toString.call(a);if(d!=Object.prototype.toString.call(b))return!1;if("[object Date]"==d)return a.valueOf()===b.valueOf();var f,g=0,h=0;if("[object Array]"==d&&a.length!==b.length)return!1;for(f in a)if(g+=1,!p(a[f],b[f]))return!1;for(f in b)h+=1;return g==h},functionName:function(a){var b=a.displayName||a.name;if(!b){var c=a.toString().match(/function ([^\s\(]+)/);b=c&&c[1]}return b},functionToString:function(){if(this.getCall&&this.callCount)for(var a,b,c=this.callCount;c--;){a=this.getCall(c).thisValue;for(b in a)if(a[b]===this)return b}return this.displayName||"sinon fake"},getConfig:function(a){var b={};a=a||{};var c=j.defaultConfig;for(var d in c)c.hasOwnProperty(d)&&(b[d]=a.hasOwnProperty(d)?a[d]:c[d]);return b},format:function(a){return""+a},defaultConfig:{injectIntoThis:!0,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:!0,useFakeServer:!0},timesInWords:function(a){return 1==a&&"once"||2==a&&"twice"||3==a&&"thrice"||(a||0)+" times"},calledInOrder:function(a){for(var b=1,c=a.length;c>b;b++)if(!a[b-1].calledBefore(a[b])||!a[b].called)return!1;return!0},orderByFirstCall:function(a){return a.sort(function(a,b){var c=a.getCall(0),d=b.getCall(0),e=c&&c.callId||-1,f=d&&d.callId||-1;return f>e?-1:1})},log:function(){},logError:function(a,b){var c=a+" threw exception: ";j.log(c+"["+b.name+"] "+b.message),b.stack&&j.log(b.stack),setTimeout(function(){throw b.message=c+b.message,b},0)},typeOf:function(a){if(null===a)return"null";if(void 0===a)return"undefined";var b=Object.prototype.toString.call(a);return b.substring(8,b.length-1).toLowerCase()},createStubInstance:function(a){if("function"!=typeof a)throw new TypeError("The constructor should be a function.");return j.stub(j.create(a.prototype))},restore:function(a){if(null!==a&&"object"==typeof a)for(var b in a)g(a[b])&&a[b].restore();else g(a)&&a.restore()}},k="undefined"!=typeof module&&module.exports,l="function"==typeof define&&"object"==typeof define.amd&&define.amd;if(l)define(function(){return j});else if(k){try{a=require("formatio")}catch(m){}module.exports=j,module.exports.spy=require("./sinon/spy"),module.exports.spyCall=require("./sinon/call"),module.exports.behavior=require("./sinon/behavior"),module.exports.stub=require("./sinon/stub"),module.exports.mock=require("./sinon/mock"),module.exports.collection=require("./sinon/collection"),module.exports.assert=require("./sinon/assert"),module.exports.sandbox=require("./sinon/sandbox"),module.exports.test=require("./sinon/test"),module.exports.testCase=require("./sinon/test_case"),module.exports.assert=require("./sinon/assert"),module.exports.match=require("./sinon/match")}if(a){var n=a.configure({quoteStrings:!1});j.format=function(){return n.ascii.apply(n,arguments)}}else if(k)try{var o=require("util");j.format=function(a){return"object"==typeof a&&a.toString===Object.prototype.toString?o.inspect(a):a}}catch(m){}return j}("object"==typeof formatio&&formatio);if(function(a){function b(b,c,d){var e=a.typeOf(b);if(e!==c)throw new TypeError("Expected type of "+d+" to be "+c+", but was "+e)}function c(a){return g.isPrototypeOf(a)}function d(b,c){if(null===c||void 0===c)return!1;for(var e in b)if(b.hasOwnProperty(e)){var f=b[e],g=c[e];if(h.isMatcher(f)){if(!f.test(g))return!1}else if("object"===a.typeOf(f)){if(!d(f,g))return!1}else if(!a.deepEqual(f,g))return!1}return!0}function e(c,d){return function(e,f){b(e,"string","property");var g=1===arguments.length,i=d+'("'+e+'"';return g||(i+=", "+f),i+=")",h(function(b){return void 0!==b&&null!==b&&c(b,e)?g||a.deepEqual(f,b[e]):!1},i)}}var f="undefined"!=typeof module&&module.exports;if(!a&&f&&(a=require("../sinon")),a){var g={toString:function(){return this.message}};g.or=function(b){if(!arguments.length)throw new TypeError("Matcher expected");c(b)||(b=h(b));var d=this,e=a.create(g);return e.test=function(a){return d.test(a)||b.test(a)},e.message=d.message+".or("+b.message+")",e},g.and=function(b){if(!arguments.length)throw new TypeError("Matcher expected");c(b)||(b=h(b));var d=this,e=a.create(g);return e.test=function(a){return d.test(a)&&b.test(a)},e.message=d.message+".and("+b.message+")",e};var h=function(b,c){var e=a.create(g),f=a.typeOf(b);switch(f){case"object":if("function"==typeof b.test)return e.test=function(a){return b.test(a)===!0},e.message="match("+a.functionName(b.test)+")",e;var h=[];for(var i in b)b.hasOwnProperty(i)&&h.push(i+": "+b[i]);e.test=function(a){return d(b,a)},e.message="match("+h.join(", ")+")";break;case"number":e.test=function(a){return b==a};break;case"string":e.test=function(a){return"string"!=typeof a?!1:-1!==a.indexOf(b)},e.message='match("'+b+'")';break;case"regexp":e.test=function(a){return"string"!=typeof a?!1:b.test(a)};break;case"function":e.test=b,e.message=c?c:"match("+a.functionName(b)+")";break;default:e.test=function(c){return a.deepEqual(b,c)}}return e.message||(e.message="match("+b+")"),e};h.isMatcher=c,h.any=h(function(){return!0},"any"),h.defined=h(function(a){return null!==a&&void 0!==a},"defined"),h.truthy=h(function(a){return!!a},"truthy"),h.falsy=h(function(a){return!a},"falsy"),h.same=function(a){return h(function(b){return a===b},"same("+a+")")},h.typeOf=function(c){return b(c,"string","type"),h(function(b){return a.typeOf(b)===c},'typeOf("'+c+'")')},h.instanceOf=function(c){return b(c,"function","type"),h(function(a){return a instanceof c},"instanceOf("+a.functionName(c)+")")},h.has=e(function(a,b){return"object"==typeof a?b in a:void 0!==a[b]},"has"),h.hasOwn=e(function(a,b){return a.hasOwnProperty(b)},"hasOwn"),h.bool=h.typeOf("boolean"),h.number=h.typeOf("number"),h.string=h.typeOf("string"),h.object=h.typeOf("object"),h.func=h.typeOf("function"),h.array=h.typeOf("array"),h.regexp=h.typeOf("regexp"),h.date=h.typeOf("date"),f?module.exports=h:a.match=h}}("object"==typeof sinon&&sinon||null),function(a){function b(b,c,d){var f=a.functionName(b)+c;throw d.length&&(f+=" Received ["+e.call(d).join(", ")+"]"),new Error(f)}function c(b,c,d,e,g,h){if("number"!=typeof h)throw new TypeError("Call id is not a number");var i=a.create(f);return i.proxy=b,i.thisValue=c,i.args=d,i.returnValue=e,i.exception=g,i.callId=h,i}var d="undefined"!=typeof module&&module.exports;if(!a&&d&&(a=require("../sinon")),a){var e=Array.prototype.slice,f={calledOn:function(b){return a.match&&a.match.isMatcher(b)?b.test(this.thisValue):this.thisValue===b},calledWith:function(){for(var b=0,c=arguments.length;c>b;b+=1)if(!a.deepEqual(arguments[b],this.args[b]))return!1;return!0},calledWithMatch:function(){for(var b=0,c=arguments.length;c>b;b+=1){var d=this.args[b],e=arguments[b];if(!a.match||!a.match(e).test(d))return!1}return!0},calledWithExactly:function(){return arguments.length==this.args.length&&this.calledWith.apply(this,arguments)},notCalledWith:function(){return!this.calledWith.apply(this,arguments)},notCalledWithMatch:function(){return!this.calledWithMatch.apply(this,arguments)},returned:function(b){return a.deepEqual(b,this.returnValue)},threw:function(a){return"undefined"!=typeof a&&this.exception?this.exception===a||this.exception.name===a:!!this.exception},calledWithNew:function(){return this.proxy.prototype&&this.thisValue instanceof this.proxy},calledBefore:function(a){return this.callId<a.callId},calledAfter:function(a){return this.callId>a.callId},callArg:function(a){this.args[a]()},callArgOn:function(a,b){this.args[a].apply(b)},callArgWith:function(a){this.callArgOnWith.apply(this,[a,null].concat(e.call(arguments,1)))},callArgOnWith:function(a,b){var c=e.call(arguments,2);this.args[a].apply(b,c)},"yield":function(){this.yieldOn.apply(this,[null].concat(e.call(arguments,0)))},yieldOn:function(a){for(var c=this.args,d=0,f=c.length;f>d;++d)if("function"==typeof c[d])return void c[d].apply(a,e.call(arguments,1));b(this.proxy," cannot yield since no callback was passed.",c)},yieldTo:function(a){this.yieldToOn.apply(this,[a,null].concat(e.call(arguments,1)))},yieldToOn:function(a,c){for(var d=this.args,f=0,g=d.length;g>f;++f)if(d[f]&&"function"==typeof d[f][a])return void d[f][a].apply(c,e.call(arguments,2));b(this.proxy," cannot yield to '"+a+"' since no callback was passed.",d)},toString:function(){for(var b=this.proxy.toString()+"(",c=[],d=0,e=this.args.length;e>d;++d)c.push(a.format(this.args[d]));return b=b+c.join(", ")+")","undefined"!=typeof this.returnValue&&(b+=" => "+a.format(this.returnValue)),this.exception&&(b+=" !"+this.exception.name,this.exception.message&&(b+="("+this.exception.message+")")),b}};f.invokeCallback=f.yield,c.toString=f.toString,d?module.exports=c:a.spyCall=c}}("object"==typeof sinon&&sinon||null),function(sinon){function spy(a,b){if(!b&&"function"==typeof a)return spy.create(a);if(!a&&!b)return spy.create(function(){});var c=a[b];return sinon.wrapMethod(a,b,spy.create(c))}function matchingFake(a,b,c){if(a)for(var d=0,e=a.length;e>d;d++)if(a[d].matches(b,c))return a[d]}function incrementCallCount(){this.called=!0,this.callCount+=1,this.notCalled=!1,this.calledOnce=1==this.callCount,this.calledTwice=2==this.callCount,this.calledThrice=3==this.callCount}function createCallProperties(){this.firstCall=this.getCall(0),this.secondCall=this.getCall(1),this.thirdCall=this.getCall(2),this.lastCall=this.getCall(this.callCount-1)}function createProxy(func){var p;return func.length?eval("p = (function proxy("+vars.substring(0,2*func.length-1)+") { return p.invoke(func, this, slice.call(arguments)); });"):p=function(){return p.invoke(func,this,slice.call(arguments))},p}function delegateToCalls(a,b,c,d){spyApi[a]=function(){if(!this.called)return d?d.apply(this,arguments):!1;for(var e,f=0,g=0,h=this.callCount;h>g;g+=1)if(e=this.getCall(g),e[c||a].apply(e,arguments)&&(f+=1,b))return!0;return f===this.callCount}}var commonJSModule="undefined"!=typeof module&&module.exports,push=Array.prototype.push,slice=Array.prototype.slice,callId=0;if(!sinon&&commonJSModule&&(sinon=require("../sinon")),sinon){var vars="a,b,c,d,e,f,g,h,i,j,k,l",uuid=0,spyApi={reset:function(){if(this.called=!1,this.notCalled=!0,this.calledOnce=!1,this.calledTwice=!1,this.calledThrice=!1,this.callCount=0,this.firstCall=null,this.secondCall=null,this.thirdCall=null,this.lastCall=null,this.args=[],this.returnValues=[],this.thisValues=[],this.exceptions=[],this.callIds=[],this.fakes)for(var a=0;a<this.fakes.length;a++)this.fakes[a].reset()},create:function(a){var b;"function"!=typeof a?a=function(){}:b=sinon.functionName(a);var c=createProxy(a);return sinon.extend(c,spy),delete c.create,sinon.extend(c,a),c.reset(),c.prototype=a.prototype,c.displayName=b||"spy",c.toString=sinon.functionToString,c._create=sinon.spy.create,c.id="spy#"+uuid++,c},invoke:function(a,b,c){var d,e,f=matchingFake(this.fakes,c);incrementCallCount.call(this),push.call(this.thisValues,b),push.call(this.args,c),push.call(this.callIds,callId++);try{e=f?f.invoke(a,b,c):(this.func||a).apply(b,c);var g=this.getCall(this.callCount-1);g.calledWithNew()&&"object"!=typeof e&&(e=b)}catch(h){d=h}if(push.call(this.exceptions,d),push.call(this.returnValues,e),createCallProperties.call(this),void 0!==d)throw d;return e},getCall:function(a){return 0>a||a>=this.callCount?null:sinon.spyCall(this,this.thisValues[a],this.args[a],this.returnValues[a],this.exceptions[a],this.callIds[a])},getCalls:function(){var a,b=[];for(a=0;a<this.callCount;a++)b.push(this.getCall(a));return b},calledBefore:function(a){return this.called?a.called?this.callIds[0]<a.callIds[a.callIds.length-1]:!0:!1},calledAfter:function(a){return this.called&&a.called?this.callIds[this.callCount-1]>a.callIds[a.callCount-1]:!1},withArgs:function(){var a=slice.call(arguments);if(this.fakes){var b=matchingFake(this.fakes,a,!0);if(b)return b}else this.fakes=[];var c=this,d=this._create();d.matchingAguments=a,d.parent=this,push.call(this.fakes,d),d.withArgs=function(){return c.withArgs.apply(c,arguments)};for(var e=0;e<this.args.length;e++)d.matches(this.args[e])&&(incrementCallCount.call(d),push.call(d.thisValues,this.thisValues[e]),push.call(d.args,this.args[e]),push.call(d.returnValues,this.returnValues[e]),push.call(d.exceptions,this.exceptions[e]),push.call(d.callIds,this.callIds[e]));return createCallProperties.call(d),d},matches:function(a,b){var c=this.matchingAguments;return c.length<=a.length&&sinon.deepEqual(c,a.slice(0,c.length))?!b||c.length==a.length:void 0},printf:function(a){var b,c=this,d=slice.call(arguments,1);return(a||"").replace(/%(.)/g,function(a,e){return b=spyApi.formatters[e],"function"==typeof b?b.call(null,c,d):isNaN(parseInt(e,10))?"%"+e:sinon.format(d[e-1])})}};delegateToCalls("calledOn",!0),delegateToCalls("alwaysCalledOn",!1,"calledOn"),delegateToCalls("calledWith",!0),delegateToCalls("calledWithMatch",!0),delegateToCalls("alwaysCalledWith",!1,"calledWith"),delegateToCalls("alwaysCalledWithMatch",!1,"calledWithMatch"),delegateToCalls("calledWithExactly",!0),delegateToCalls("alwaysCalledWithExactly",!1,"calledWithExactly"),delegateToCalls("neverCalledWith",!1,"notCalledWith",function(){return!0}),delegateToCalls("neverCalledWithMatch",!1,"notCalledWithMatch",function(){return!0}),delegateToCalls("threw",!0),delegateToCalls("alwaysThrew",!1,"threw"),delegateToCalls("returned",!0),delegateToCalls("alwaysReturned",!1,"returned"),delegateToCalls("calledWithNew",!0),delegateToCalls("alwaysCalledWithNew",!1,"calledWithNew"),delegateToCalls("callArg",!1,"callArgWith",function(){throw new Error(this.toString()+" cannot call arg since it was not yet invoked.")}),spyApi.callArgWith=spyApi.callArg,delegateToCalls("callArgOn",!1,"callArgOnWith",function(){throw new Error(this.toString()+" cannot call arg since it was not yet invoked.")}),spyApi.callArgOnWith=spyApi.callArgOn,delegateToCalls("yield",!1,"yield",function(){throw new Error(this.toString()+" cannot yield since it was not yet invoked.")}),spyApi.invokeCallback=spyApi.yield,delegateToCalls("yieldOn",!1,"yieldOn",function(){throw new Error(this.toString()+" cannot yield since it was not yet invoked.")}),delegateToCalls("yieldTo",!1,"yieldTo",function(a){throw new Error(this.toString()+" cannot yield to '"+a+"' since it was not yet invoked.")}),delegateToCalls("yieldToOn",!1,"yieldToOn",function(a){throw new Error(this.toString()+" cannot yield to '"+a+"' since it was not yet invoked.")}),spyApi.formatters={c:function(a){return sinon.timesInWords(a.callCount)},n:function(a){return a.toString()},C:function(a){for(var b=[],c=0,d=a.callCount;d>c;++c){var e="    "+a.getCall(c).toString();/\n/.test(b[c-1])&&(e="\n"+e),push.call(b,e)}return b.length>0?"\n"+b.join("\n"):""},t:function(a){for(var b=[],c=0,d=a.callCount;d>c;++c)push.call(b,sinon.format(a.thisValues[c]));return b.join(", ")},"*":function(a,b){for(var c=[],d=0,e=b.length;e>d;++d)push.call(c,sinon.format(b[d]));return c.join(", ")}},sinon.extend(spy,spyApi),spy.spyCall=sinon.spyCall,commonJSModule?module.exports=spy:sinon.spy=spy}}("object"==typeof sinon&&sinon||null),function(a){function b(a,b){return"string"==typeof a?(this.exception=new Error(b||""),this.exception.name=a):this.exception=a?a:new Error("Error"),this}function c(a,b){var c=a.callArgAt;if(0>c){for(var d=a.callArgProp,e=0,f=b.length;f>e;++e){if(!d&&"function"==typeof b[e])return b[e];if(d&&b[e]&&"function"==typeof b[e][d])return b[e][d]}return null}return b[c]}function d(b,c,d){if(b.callArgAt<0){var e;return e=b.callArgProp?a.functionName(b.stub)+" expected to yield to '"+b.callArgProp+"', but no object with such a property was passed.":a.functionName(b.stub)+" expected to yield, but no callback was passed.",d.length>0&&(e+=" Received ["+i.call(d,", ")+"]"),e}return"argument at index "+b.callArgAt+" is not a function: "+c}function e(a,b){if("number"==typeof a.callArgAt){var e=c(a,b);if("function"!=typeof e)throw new TypeError(d(a,e,b));a.callbackAsync?j(function(){e.apply(a.callbackContext,a.callbackArguments)}):e.apply(a.callbackContext,a.callbackArguments)}}var f="undefined"!=typeof module&&module.exports;if(!a&&f&&(a=require("../sinon")),a){var g,h=Array.prototype.slice,i=Array.prototype.join,j=function(){return"object"==typeof process&&"function"==typeof process.nextTick?process.nextTick:"function"==typeof setImmediate?setImmediate:function(a){setTimeout(a,0)}}();g={create:function(b){var c=a.extend({},a.behavior);return delete c.create,c.stub=b,c},isPresent:function(){return"number"==typeof this.callArgAt||this.exception||"number"==typeof this.returnArgAt||this.returnThis||this.returnValueDefined},invoke:function(a,b){if(e(this,b),this.exception)throw this.exception;return"number"==typeof this.returnArgAt?b[this.returnArgAt]:this.returnThis?a:this.returnValue},onCall:function(a){return this.stub.onCall(a)},onFirstCall:function(){return this.stub.onFirstCall()
},onSecondCall:function(){return this.stub.onSecondCall()},onThirdCall:function(){return this.stub.onThirdCall()},withArgs:function(){throw new Error('Defining a stub by invoking "stub.onCall(...).withArgs(...)" is not supported. Use "stub.withArgs(...).onCall(...)" to define sequential behavior for calls with certain arguments.')},callsArg:function(a){if("number"!=typeof a)throw new TypeError("argument index is not number");return this.callArgAt=a,this.callbackArguments=[],this.callbackContext=void 0,this.callArgProp=void 0,this.callbackAsync=!1,this},callsArgOn:function(a,b){if("number"!=typeof a)throw new TypeError("argument index is not number");if("object"!=typeof b)throw new TypeError("argument context is not an object");return this.callArgAt=a,this.callbackArguments=[],this.callbackContext=b,this.callArgProp=void 0,this.callbackAsync=!1,this},callsArgWith:function(a){if("number"!=typeof a)throw new TypeError("argument index is not number");return this.callArgAt=a,this.callbackArguments=h.call(arguments,1),this.callbackContext=void 0,this.callArgProp=void 0,this.callbackAsync=!1,this},callsArgOnWith:function(a,b){if("number"!=typeof a)throw new TypeError("argument index is not number");if("object"!=typeof b)throw new TypeError("argument context is not an object");return this.callArgAt=a,this.callbackArguments=h.call(arguments,2),this.callbackContext=b,this.callArgProp=void 0,this.callbackAsync=!1,this},yields:function(){return this.callArgAt=-1,this.callbackArguments=h.call(arguments,0),this.callbackContext=void 0,this.callArgProp=void 0,this.callbackAsync=!1,this},yieldsOn:function(a){if("object"!=typeof a)throw new TypeError("argument context is not an object");return this.callArgAt=-1,this.callbackArguments=h.call(arguments,1),this.callbackContext=a,this.callArgProp=void 0,this.callbackAsync=!1,this},yieldsTo:function(a){return this.callArgAt=-1,this.callbackArguments=h.call(arguments,1),this.callbackContext=void 0,this.callArgProp=a,this.callbackAsync=!1,this},yieldsToOn:function(a,b){if("object"!=typeof b)throw new TypeError("argument context is not an object");return this.callArgAt=-1,this.callbackArguments=h.call(arguments,2),this.callbackContext=b,this.callArgProp=a,this.callbackAsync=!1,this},"throws":b,throwsException:b,returns:function(a){return this.returnValue=a,this.returnValueDefined=!0,this},returnsArg:function(a){if("number"!=typeof a)throw new TypeError("argument index is not number");return this.returnArgAt=a,this},returnsThis:function(){return this.returnThis=!0,this}};for(var k in g)g.hasOwnProperty(k)&&k.match(/^(callsArg|yields)/)&&!k.match(/Async/)&&(g[k+"Async"]=function(a){return function(){var b=this[a].apply(this,arguments);return this.callbackAsync=!0,b}}(k));f?module.exports=g:a.behavior=g}}("object"==typeof sinon&&sinon||null),function(a){function b(c,d,e){if(e&&"function"!=typeof e)throw new TypeError("Custom stub should be function");var f;if(f=e?a.spy&&a.spy.create?a.spy.create(e):e:b.create(),!c&&"undefined"==typeof d)return a.stub.create();if("undefined"==typeof d&&"object"==typeof c){for(var g in c)"function"==typeof c[g]&&b(c,g);return c}return a.wrapMethod(c,d,f)}function c(b){return b.defaultBehavior||d(b)||a.behavior.create(b)}function d(a){return a.parent&&e(a.parent)}function e(a){var b=a.behaviors[a.callCount-1];return b&&b.isPresent()?b:c(a)}var f="undefined"!=typeof module&&module.exports;if(!a&&f&&(a=require("../sinon")),a){var g=0;a.extend(b,function(){var c={create:function(){var c=function(){return e(c).invoke(this,arguments)};c.id="stub#"+g++;var d=c;return c=a.spy.create(c),c.func=d,a.extend(c,b),c._create=a.stub.create,c.displayName="stub",c.toString=a.functionToString,c.defaultBehavior=null,c.behaviors=[],c},resetBehavior:function(){var a;if(this.defaultBehavior=null,this.behaviors=[],delete this.returnValue,delete this.returnArgAt,this.returnThis=!1,this.fakes)for(a=0;a<this.fakes.length;a++)this.fakes[a].resetBehavior()},onCall:function(b){return this.behaviors[b]||(this.behaviors[b]=a.behavior.create(this)),this.behaviors[b]},onFirstCall:function(){return this.onCall(0)},onSecondCall:function(){return this.onCall(1)},onThirdCall:function(){return this.onCall(2)}};for(var d in a.behavior)a.behavior.hasOwnProperty(d)&&!c.hasOwnProperty(d)&&"create"!=d&&"withArgs"!=d&&"invoke"!=d&&(c[d]=function(b){return function(){return this.defaultBehavior=this.defaultBehavior||a.behavior.create(this),this.defaultBehavior[b].apply(this.defaultBehavior,arguments),this}}(d));return c}()),f?module.exports=b:a.stub=b}}("object"==typeof sinon&&sinon||null),function(a){function b(c){return c?b.create(c):a.expectation.create("Anonymous mock")}var c,d="undefined"!=typeof module&&module.exports,e=[].push;if(!a&&d&&(a=require("../sinon")),a){c=a.match,!c&&d&&(c=require("./match")),a.mock=b,a.extend(b,function(){function c(a,b){if(a)for(var c=0,d=a.length;d>c;c+=1)b(a[c])}return{create:function(c){if(!c)throw new TypeError("object is null");var d=a.extend({},b);return d.object=c,delete d.create,d},expects:function(b){if(!b)throw new TypeError("method is falsy");if(this.expectations||(this.expectations={},this.proxies=[]),!this.expectations[b]){this.expectations[b]=[];var c=this;a.wrapMethod(this.object,b,function(){return c.invokeMethod(b,this,arguments)}),e.call(this.proxies,b)}var d=a.expectation.create(b);return e.call(this.expectations[b],d),d},restore:function(){var a=this.object;c(this.proxies,function(b){"function"==typeof a[b].restore&&a[b].restore()})},verify:function(){var b=this.expectations||{},d=[],f=[];return c(this.proxies,function(a){c(b[a],function(a){a.met()?e.call(f,a.toString()):e.call(d,a.toString())})}),this.restore(),d.length>0?a.expectation.fail(d.concat(f).join("\n")):a.expectation.pass(d.concat(f).join("\n")),!0},invokeMethod:function(b,c,d){var f,g=this.expectations&&this.expectations[b],h=g&&g.length||0;for(f=0;h>f;f+=1)if(!g[f].met()&&g[f].allowsCall(c,d))return g[f].apply(c,d);var i,j=[],k=0;for(f=0;h>f;f+=1)g[f].allowsCall(c,d)?i=i||g[f]:k+=1,e.call(j,"    "+g[f].toString());return 0===k?i.apply(c,d):(j.unshift("Unexpected call: "+a.spyCall.toString.call({proxy:b,args:d})),void a.expectation.fail(j.join("\n")))}}}());var f=a.timesInWords;a.expectation=function(){function b(a){return 0==a?"never called":"called "+f(a)}function d(a){var b=a.minCalls,c=a.maxCalls;if("number"==typeof b&&"number"==typeof c){var d=f(b);return b!=c&&(d="at least "+d+" and at most "+f(c)),d}return"number"==typeof b?"at least "+f(b):"at most "+f(c)}function g(a){var b="number"==typeof a.minCalls;return!b||a.callCount>=a.minCalls}function h(a){return"number"!=typeof a.maxCalls?!1:a.callCount==a.maxCalls}function i(a,b){return c&&c.isMatcher(a)?a.test(b):!0}var j=Array.prototype.slice,k=a.spy.invoke;return{minCalls:1,maxCalls:1,create:function(b){var c=a.extend(a.stub.create(),a.expectation);return delete c.create,c.method=b,c},invoke:function(a,b,c){return this.verifyCallAllowed(b,c),k.apply(this,arguments)},atLeast:function(a){if("number"!=typeof a)throw new TypeError("'"+a+"' is not number");return this.limitsSet||(this.maxCalls=null,this.limitsSet=!0),this.minCalls=a,this},atMost:function(a){if("number"!=typeof a)throw new TypeError("'"+a+"' is not number");return this.limitsSet||(this.minCalls=null,this.limitsSet=!0),this.maxCalls=a,this},never:function(){return this.exactly(0)},once:function(){return this.exactly(1)},twice:function(){return this.exactly(2)},thrice:function(){return this.exactly(3)},exactly:function(a){if("number"!=typeof a)throw new TypeError("'"+a+"' is not a number");return this.atLeast(a),this.atMost(a)},met:function(){return!this.failed&&g(this)},verifyCallAllowed:function(b,c){if(h(this)&&(this.failed=!0,a.expectation.fail(this.method+" already called "+f(this.maxCalls))),"expectedThis"in this&&this.expectedThis!==b&&a.expectation.fail(this.method+" called with "+b+" as thisValue, expected "+this.expectedThis),"expectedArguments"in this){c||a.expectation.fail(this.method+" received no arguments, expected "+a.format(this.expectedArguments)),c.length<this.expectedArguments.length&&a.expectation.fail(this.method+" received too few arguments ("+a.format(c)+"), expected "+a.format(this.expectedArguments)),this.expectsExactArgCount&&c.length!=this.expectedArguments.length&&a.expectation.fail(this.method+" received too many arguments ("+a.format(c)+"), expected "+a.format(this.expectedArguments));for(var d=0,e=this.expectedArguments.length;e>d;d+=1)i(this.expectedArguments[d],c[d])||a.expectation.fail(this.method+" received wrong arguments "+a.format(c)+", didn't match "+this.expectedArguments.toString()),a.deepEqual(this.expectedArguments[d],c[d])||a.expectation.fail(this.method+" received wrong arguments "+a.format(c)+", expected "+a.format(this.expectedArguments))}},allowsCall:function(b,c){if(this.met()&&h(this))return!1;if("expectedThis"in this&&this.expectedThis!==b)return!1;if(!("expectedArguments"in this))return!0;if(c=c||[],c.length<this.expectedArguments.length)return!1;if(this.expectsExactArgCount&&c.length!=this.expectedArguments.length)return!1;for(var d=0,e=this.expectedArguments.length;e>d;d+=1){if(!i(this.expectedArguments[d],c[d]))return!1;if(!a.deepEqual(this.expectedArguments[d],c[d]))return!1}return!0},withArgs:function(){return this.expectedArguments=j.call(arguments),this},withExactArgs:function(){return this.withArgs.apply(this,arguments),this.expectsExactArgCount=!0,this},on:function(a){return this.expectedThis=a,this},toString:function(){var c=(this.expectedArguments||[]).slice();this.expectsExactArgCount||e.call(c,"[...]");var f=a.spyCall.toString.call({proxy:this.method||"anonymous mock expectation",args:c}),g=f.replace(", [...","[, ...")+" "+d(this);return this.met()?"Expectation met: "+g:"Expected "+g+" ("+b(this.callCount)+")"},verify:function(){return this.met()?a.expectation.pass(this.toString()):a.expectation.fail(this.toString()),!0},pass:function(b){a.assert.pass(b)},fail:function(a){var b=new Error(a);throw b.name="ExpectationError",b}}}(),d?module.exports=b:a.mock=b}}("object"==typeof sinon&&sinon||null),function(a){function b(a){return a.fakes||(a.fakes=[]),a.fakes}function c(a,c){for(var d=b(a),e=0,f=d.length;f>e;e+=1)"function"==typeof d[e][c]&&d[e][c]()}function d(a){for(var c=b(a),d=0;d<c.length;)c.splice(d,1)}var e="undefined"!=typeof module&&module.exports,f=[].push,g=Object.prototype.hasOwnProperty;if(!a&&e&&(a=require("../sinon")),a){var h={verify:function(){c(this,"verify")},restore:function(){c(this,"restore"),d(this)},verifyAndRestore:function(){var a;try{this.verify()}catch(b){a=b}if(this.restore(),a)throw a},add:function(a){return f.call(b(this),a),a},spy:function(){return this.add(a.spy.apply(a,arguments))},stub:function(b,c,d){if(c){var e=b[c];if("function"!=typeof e){if(!g.call(b,c))throw new TypeError("Cannot stub non-existent own property "+c);return b[c]=d,this.add({restore:function(){b[c]=e}})}}if(!c&&b&&"object"==typeof b){var f=a.stub.apply(a,arguments);for(var h in f)"function"==typeof f[h]&&this.add(f[h]);return f}return this.add(a.stub.apply(a,arguments))},mock:function(){return this.add(a.mock.apply(a,arguments))},inject:function(a){var b=this;return a.spy=function(){return b.spy.apply(b,arguments)},a.stub=function(){return b.stub.apply(b,arguments)},a.mock=function(){return b.mock.apply(b,arguments)},a}};e?module.exports=h:a.collection=h}}("object"==typeof sinon&&sinon||null),"undefined"==typeof sinon)var sinon={};if(function(global){function addTimer(a,b){if(0===a.length)throw new Error("Function requires at least 1 parameter");if("undefined"==typeof a[0])throw new Error("Callback must be provided to timer calls");var c=id++,d=a[1]||0;return this.timeouts||(this.timeouts={}),this.timeouts[c]={id:c,func:a[0],callAt:this.now+d,invokeArgs:Array.prototype.slice.call(a,2)},b===!0&&(this.timeouts[c].interval=d),addTimerReturnsObject?{id:c,ref:function(){},unref:function(){}}:c}function parseTime(a){if(!a)return 0;var b,c=a.split(":"),d=c.length,e=d,f=0;if(d>3||!/^(\d\d:){0,2}\d\d?$/.test(a))throw new Error("tick only understands numbers and 'h:m:s'");for(;e--;){if(b=parseInt(c[e],10),b>=60)throw new Error("Invalid time "+a);f+=b*Math.pow(60,d-e-1)}return 1e3*f}function createObject(a){var b;if(Object.create)b=Object.create(a);else{var c=function(){};c.prototype=a,b=new c}return b.Date.clock=b,b}function mirrorDateProperties(a,b){b.now?a.now=function(){return a.clock.now}:delete a.now,b.toSource?a.toSource=function(){return b.toSource()}:delete a.toSource,a.toString=function(){return b.toString()},a.prototype=b.prototype,a.parse=b.parse,a.UTC=b.UTC,a.prototype.toUTCString=b.prototype.toUTCString;for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function restore(){for(var a,b=0,c=this.methods.length;c>b;b++)if(a=this.methods[b],global[a].hadOwnProperty)global[a]=this["_"+a];else try{delete global[a]}catch(d){}this.methods=[]}function stubGlobal(a,b){if(b[a].hadOwnProperty=Object.prototype.hasOwnProperty.call(global,a),b["_"+a]=global[a],"Date"==a){var c=mirrorDateProperties(b[a],global[a]);global[a]=c}else{global[a]=function(){return b[a].apply(b,arguments)};for(var d in b[a])b[a].hasOwnProperty(d)&&(global[a][d]=b[a][d])}global[a].clock=b}var timeoutResult=setTimeout(function(){},0),addTimerReturnsObject="object"==typeof timeoutResult;clearTimeout(timeoutResult);var id=1;sinon.clock={now:0,create:function(a){var b=createObject(this);if("number"==typeof a&&(b.now=a),a&&"object"==typeof a)throw new TypeError("now should be milliseconds since UNIX epoch");return b},setTimeout:function(){return addTimer.call(this,arguments,!1)},clearTimeout:function(a){this.timeouts||(this.timeouts=[]),a in this.timeouts&&delete this.timeouts[a]},setInterval:function(){return addTimer.call(this,arguments,!0)},clearInterval:function(a){this.clearTimeout(a)},setImmediate:function(a){var b=Array.prototype.slice.call(arguments,1);return addTimer.call(this,[a,0].concat(b),!1)},clearImmediate:function(a){this.clearTimeout(a)},tick:function(a){a="number"==typeof a?a:parseTime(a);for(var b,c=this.now,d=this.now+a,e=this.now,f=this.firstTimerInRange(c,d);f&&d>=c;){if(this.timeouts[f.id]){c=this.now=f.callAt;try{this.callTimer(f)}catch(g){b=b||g}}f=this.firstTimerInRange(e,d),e=c}if(this.now=d,b)throw b;return this.now},firstTimerInRange:function(a,b){var c,d,e=null;for(var f in this.timeouts)if(this.timeouts.hasOwnProperty(f)){if(this.timeouts[f].callAt<a||this.timeouts[f].callAt>b)continue;(null===e||this.timeouts[f].callAt<e)&&(d=this.timeouts[f],e=this.timeouts[f].callAt,c={func:this.timeouts[f].func,callAt:this.timeouts[f].callAt,interval:this.timeouts[f].interval,id:this.timeouts[f].id,invokeArgs:this.timeouts[f].invokeArgs})}return c||null},callTimer:function(timer){"number"==typeof timer.interval?this.timeouts[timer.id].callAt+=timer.interval:delete this.timeouts[timer.id];try{"function"==typeof timer.func?timer.func.apply(null,timer.invokeArgs):eval(timer.func)}catch(e){var exception=e}if(this.timeouts[timer.id]){if(exception)throw exception}else if(exception)throw exception},reset:function(){this.timeouts={}},Date:function(){function a(c,d,e,f,g,h,i){switch(arguments.length){case 0:return new b(a.clock.now);case 1:return new b(c);case 2:return new b(c,d);case 3:return new b(c,d,e);case 4:return new b(c,d,e,f);case 5:return new b(c,d,e,f,g);case 6:return new b(c,d,e,f,g,h);default:return new b(c,d,e,f,g,h,i)}}var b=Date;return mirrorDateProperties(a,b)}()};var methods=["Date","setTimeout","setInterval","clearTimeout","clearInterval"];"undefined"!=typeof global.setImmediate&&methods.push("setImmediate"),"undefined"!=typeof global.clearImmediate&&methods.push("clearImmediate"),sinon.useFakeTimers=function(a){var b=sinon.clock.create(a);b.restore=restore,b.methods=Array.prototype.slice.call(arguments,"number"==typeof a?1:0),0===b.methods.length&&(b.methods=methods);for(var c=0,d=b.methods.length;d>c;c++)stubGlobal(b.methods[c],b);return b}}("undefined"!=typeof global&&"function"!=typeof global?global:this),sinon.timers={setTimeout:setTimeout,clearTimeout:clearTimeout,setImmediate:"undefined"!=typeof setImmediate?setImmediate:void 0,clearImmediate:"undefined"!=typeof clearImmediate?clearImmediate:void 0,setInterval:setInterval,clearInterval:clearInterval,Date:Date},"undefined"!=typeof module&&module.exports&&(module.exports=sinon),"undefined"==typeof sinon&&(this.sinon={}),function(){var a=[].push;sinon.Event=function(a,b,c,d){this.initEvent(a,b,c,d)},sinon.Event.prototype={initEvent:function(a,b,c,d){this.type=a,this.bubbles=b,this.cancelable=c,this.target=d},stopPropagation:function(){},preventDefault:function(){this.defaultPrevented=!0}},sinon.ProgressEvent=function(a,b,c){this.initEvent(a,!1,!1,c),this.loaded=b.loaded||null,this.total=b.total||null},sinon.ProgressEvent.prototype=new sinon.Event,sinon.ProgressEvent.prototype.constructor=sinon.ProgressEvent,sinon.CustomEvent=function(a,b,c){this.initEvent(a,!1,!1,c),this.detail=b.detail||null},sinon.CustomEvent.prototype=new sinon.Event,sinon.CustomEvent.prototype.constructor=sinon.CustomEvent,sinon.EventTarget={addEventListener:function(b,c){this.eventListeners=this.eventListeners||{},this.eventListeners[b]=this.eventListeners[b]||[],a.call(this.eventListeners[b],c)},removeEventListener:function(a,b){for(var c=this.eventListeners&&this.eventListeners[a]||[],d=0,e=c.length;e>d;++d)if(c[d]==b)return c.splice(d,1)},dispatchEvent:function(a){for(var b=a.type,c=this.eventListeners&&this.eventListeners[b]||[],d=0;d<c.length;d++)"function"==typeof c[d]?c[d].call(this,a):c[d].handleEvent(a);return!!a.defaultPrevented}}}(),function(a){function b(){function a(a){d.addEventListener(a,function(b){var c=d["on"+a];c&&"function"==typeof c&&c.call(this,b)})}this.readyState=b.UNSENT,this.requestHeaders={},this.requestBody=null,this.status=0,this.statusText="",this.upload=new c,sinon.xhr.supportsCORS&&(this.withCredentials=!1);for(var d=this,e=["loadstart","load","abort","loadend"],f=e.length-1;f>=0;f--)a(e[f]);"function"==typeof b.onCreate&&b.onCreate(this)}function c(){this.eventListeners={progress:[],load:[],abort:[],error:[]}}function d(a){if(a.readyState!==b.OPENED)throw new Error("INVALID_STATE_ERR");if(a.sendFlag)throw new Error("INVALID_STATE_ERR")}function e(a,b){if(a)for(var c=0,d=a.length;d>c;c+=1)b(a[c])}function f(a,b){for(var c=0;c<a.length;c++)if(b(a[c])===!0)return!0;return!1}function g(a){if(a.readyState!=b.OPENED)throw new Error("INVALID_STATE_ERR - "+a.readyState)}function h(a){if(a.readyState==b.DONE)throw new Error("Request done")}function i(a){if(a.async&&a.readyState!=b.HEADERS_RECEIVED)throw new Error("No headers received")}function j(a){if("string"!=typeof a){var b=new Error("Attempted to respond to fake XMLHttpRequest with "+a+", which is not a string.");throw b.name="InvalidBodyException",b}}"undefined"==typeof sinon&&(a.sinon={});var k="undefined"!=typeof ProgressEvent,l="undefined"!=typeof CustomEvent;sinon.xhr={XMLHttpRequest:a.XMLHttpRequest};var m=sinon.xhr;m.GlobalXMLHttpRequest=a.XMLHttpRequest,m.GlobalActiveXObject=a.ActiveXObject,m.supportsActiveX="undefined"!=typeof m.GlobalActiveXObject,m.supportsXHR="undefined"!=typeof m.GlobalXMLHttpRequest,m.workingXHR=m.supportsXHR?m.GlobalXMLHttpRequest:m.supportsActiveX?function(){return new m.GlobalActiveXObject("MSXML2.XMLHTTP.3.0")}:!1,m.supportsCORS="withCredentials"in new sinon.xhr.GlobalXMLHttpRequest;var n={"Accept-Charset":!0,"Accept-Encoding":!0,Connection:!0,"Content-Length":!0,Cookie:!0,Cookie2:!0,"Content-Transfer-Encoding":!0,Date:!0,Expect:!0,Host:!0,"Keep-Alive":!0,Referer:!0,TE:!0,Trailer:!0,"Transfer-Encoding":!0,Upgrade:!0,"User-Agent":!0,Via:!0};c.prototype.addEventListener=function(a,b){this.eventListeners[a].push(b)},c.prototype.removeEventListener=function(a,b){for(var c=this.eventListeners[a]||[],d=0,e=c.length;e>d;++d)if(c[d]==b)return c.splice(d,1)},c.prototype.dispatchEvent=function(a){for(var b,c=this.eventListeners[a.type]||[],d=0;null!=(b=c[d]);d++)b(a)};var o=function(a,b,c){switch(c.length){case 0:return a[b]();case 1:return a[b](c[0]);case 2:return a[b](c[0],c[1]);case 3:return a[b](c[0],c[1],c[2]);case 4:return a[b](c[0],c[1],c[2],c[3]);case 5:return a[b](c[0],c[1],c[2],c[3],c[4])}};b.filters=[],b.addFilter=function(a){this.filters.push(a)};var p=/MSIE 6/;b.defake=function(a,c){var d=new sinon.xhr.workingXHR;e(["open","setRequestHeader","send","abort","getResponseHeader","getAllResponseHeaders","addEventListener","overrideMimeType","removeEventListener"],function(b){a[b]=function(){return o(d,b,arguments)}});var f=function(b){e(b,function(b){try{a[b]=d[b]}catch(c){if(!p.test(navigator.userAgent))throw c}})},g=function(){a.readyState=d.readyState,d.readyState>=b.HEADERS_RECEIVED&&f(["status","statusText"]),d.readyState>=b.LOADING&&f(["responseText"]),d.readyState===b.DONE&&f(["responseXML"]),a.onreadystatechange&&a.onreadystatechange.call(a,{target:a})};if(d.addEventListener){for(var h in a.eventListeners)a.eventListeners.hasOwnProperty(h)&&e(a.eventListeners[h],function(a){d.addEventListener(h,a)});d.addEventListener("readystatechange",g)}else d.onreadystatechange=g;o(d,"open",c)},b.useFilters=!1,sinon.extend(b.prototype,sinon.EventTarget,{async:!0,open:function(a,c,d,e,g){if(console.log("open",a,c),this.method=a,this.url=c,this.async="boolean"==typeof d?d:!0,this.username=e,this.password=g,this.responseText=null,this.responseXML=null,this.requestHeaders={},this.sendFlag=!1,sinon.FakeXMLHttpRequest.useFilters===!0){var h=arguments,i=f(b.filters,function(a){return a.apply(this,h)});if(i)return sinon.FakeXMLHttpRequest.defake(this,arguments)}this.readyStateChange(b.OPENED)},readyStateChange:function(a){if(this.readyState=a,"function"==typeof this.onreadystatechange)try{this.onreadystatechange()}catch(c){sinon.logError("Fake XHR onreadystatechange handler",c)}switch(this.dispatchEvent(new sinon.Event("readystatechange")),this.readyState){case b.DONE:this.dispatchEvent(new sinon.Event("load",!1,!1,this)),this.dispatchEvent(new sinon.Event("loadend",!1,!1,this)),this.upload.dispatchEvent(new sinon.Event("load",!1,!1,this)),k&&this.upload.dispatchEvent(new sinon.ProgressEvent("progress",{loaded:100,total:100}))}},setRequestHeader:function(a,b){if(d(this),n[a]||/^(Sec-|Proxy-)/.test(a))throw new Error('Refused to set unsafe header "'+a+'"');this.requestHeaders[a]?this.requestHeaders[a]+=","+b:this.requestHeaders[a]=b},setResponseHeaders:function(a){g(this),this.responseHeaders={};for(var c in a)a.hasOwnProperty(c)&&(this.responseHeaders[c]=a[c]);this.async?this.readyStateChange(b.HEADERS_RECEIVED):this.readyState=b.HEADERS_RECEIVED},send:function(a){if(d(this),!/^(get|head)$/i.test(this.method)){if(this.requestHeaders["Content-Type"]){var c=this.requestHeaders["Content-Type"].split(";");this.requestHeaders["Content-Type"]=c[0]+";charset=utf-8"}else this.requestHeaders["Content-Type"]="text/plain;charset=utf-8";this.requestBody=a}this.errorFlag=!1,this.sendFlag=this.async,this.readyStateChange(b.OPENED),"function"==typeof this.onSend&&this.onSend(this),this.dispatchEvent(new sinon.Event("loadstart",!1,!1,this))},abort:function(){this.aborted=!0,this.responseText=null,this.errorFlag=!0,this.requestHeaders={},this.readyState>sinon.FakeXMLHttpRequest.UNSENT&&this.sendFlag&&(this.readyStateChange(sinon.FakeXMLHttpRequest.DONE),this.sendFlag=!1),this.readyState=sinon.FakeXMLHttpRequest.UNSENT,this.dispatchEvent(new sinon.Event("abort",!1,!1,this)),this.upload.dispatchEvent(new sinon.Event("abort",!1,!1,this)),"function"==typeof this.onerror&&this.onerror()},getResponseHeader:function(a){if(this.readyState<b.HEADERS_RECEIVED)return null;if(/^Set-Cookie2?$/i.test(a))return null;a=a.toLowerCase();for(var c in this.responseHeaders)if(c.toLowerCase()==a)return this.responseHeaders[c];return null},getAllResponseHeaders:function(){if(this.readyState<b.HEADERS_RECEIVED)return"";var a="";for(var c in this.responseHeaders)this.responseHeaders.hasOwnProperty(c)&&!/^Set-Cookie2?$/i.test(c)&&(a+=c+": "+this.responseHeaders[c]+"\r\n");return a},setResponseBody:function(a){h(this),i(this),j(a);var c=this.chunkSize||10,d=0;this.responseText="";do this.async&&this.readyStateChange(b.LOADING),this.responseText+=a.substring(d,d+c),d+=c;while(d<a.length);var e=this.getResponseHeader("Content-Type");if(this.responseText&&(!e||/(text\/xml)|(application\/xml)|(\+xml)/.test(e)))try{this.responseXML=b.parseXML(this.responseText)}catch(f){}this.async?this.readyStateChange(b.DONE):this.readyState=b.DONE},respond:function(a,c,d){this.status="number"==typeof a?a:200,this.statusText=b.statusCodes[this.status],this.setResponseHeaders(c||{}),this.setResponseBody(d||"")},uploadProgress:function(a){k&&this.upload.dispatchEvent(new sinon.ProgressEvent("progress",a))},uploadError:function(a){l&&this.upload.dispatchEvent(new sinon.CustomEvent("error",{detail:a}))}}),sinon.extend(b,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4}),b.parseXML=function(a){var b;if("undefined"!=typeof DOMParser){var c=new DOMParser;b=c.parseFromString(a,"text/xml")}else b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a);return b},b.statusCodes={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choice",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"},sinon.useFakeXMLHttpRequest=function(){return sinon.FakeXMLHttpRequest.restore=function(b){m.supportsXHR&&(a.XMLHttpRequest=m.GlobalXMLHttpRequest),m.supportsActiveX&&(a.ActiveXObject=m.GlobalActiveXObject),delete sinon.FakeXMLHttpRequest.restore,b!==!0&&delete sinon.FakeXMLHttpRequest.onCreate},m.supportsXHR&&(a.XMLHttpRequest=sinon.FakeXMLHttpRequest),m.supportsActiveX&&(a.ActiveXObject=function(a){return"Microsoft.XMLHTTP"==a||/^Msxml2\.XMLHTTP/i.test(a)?new sinon.FakeXMLHttpRequest:new m.GlobalActiveXObject(a)}),sinon.FakeXMLHttpRequest},sinon.FakeXMLHttpRequest=b}("object"==typeof global?global:this),"undefined"!=typeof module&&module.exports&&(module.exports=sinon),"undefined"==typeof sinon)var sinon={};if(sinon.fakeServer=function(){function a(){}function b(b){return a.prototype=b,new a}function c(a){var b=a;if("[object Array]"!=Object.prototype.toString.call(a)&&(b=[200,{},a]),"string"!=typeof b[2])throw new TypeError("Fake server response body should be string, but was "+typeof b[2]);return b}function d(a,b,c){var d=a.method,e=!d||d.toLowerCase()==b.toLowerCase(),f=a.url,g=!f||f==c||"function"==typeof f.test&&f.test(c);return e&&g}function e(a,b){var c=b.url;if((!/^https?:\/\//.test(c)||i.test(c))&&(c=c.replace(i,"")),d(a,this.getHTTPMethod(b),c)){if("function"==typeof a.response){var e=a.url,f=[b].concat(e&&"function"==typeof e.exec?e.exec(c).slice(1):[]);return a.response.apply(a,f)}return!0}return!1}function f(a,b){var c;c="Request:\n"+sinon.format(b)+"\n\n",c+="Response:\n"+sinon.format(a)+"\n\n",sinon.log(c)}var g=[].push,h="undefined"!=typeof window?window.location:{},i=new RegExp("^"+h.protocol+"//"+h.host);return{create:function(){var a=b(this);return this.xhr=sinon.useFakeXMLHttpRequest(),a.requests=[],this.xhr.onCreate=function(b){a.addRequest(b)},a},addRequest:function(a){var b=this;g.call(this.requests,a),a.onSend=function(){b.handleRequest(this),b.autoRespond&&!b.responding&&(setTimeout(function(){b.responding=!1,b.respond()},b.autoRespondAfter||10),b.responding=!0)}},getHTTPMethod:function(a){if(this.fakeHTTPMethods&&/post/i.test(a.method)){var b=(a.requestBody||"").match(/_method=([^\b;]+)/);return b?b[1]:a.method}return a.method},handleRequest:function(a){a.async?(this.queue||(this.queue=[]),g.call(this.queue,a)):this.processRequest(a)},respondWith:function(a,b,d){return 1==arguments.length&&"function"!=typeof a?void(this.response=c(a)):(this.responses||(this.responses=[]),1==arguments.length&&(d=a,b=a=null),2==arguments.length&&(d=b,b=a,a=null),void g.call(this.responses,{method:a,url:b,response:"function"==typeof d?d:c(d)}))},respond:function(){arguments.length>0&&this.respondWith.apply(this,arguments);for(var a,b=this.queue||[],c=b.splice(0);a=c.shift();)this.processRequest(a)},processRequest:function(a){try{if(a.aborted)return;var b=this.response||[404,{},""];if(this.responses)for(var c=this.responses.length,d=c-1;d>=0;d--)if(e.call(this,this.responses[d],a)){b=this.responses[d].response;break}4!=a.readyState&&(f(b,a),a.respond(b[0],b[1],b[2]))}catch(g){sinon.logError("Fake server request processing",g)}},restore:function(){return this.xhr.restore&&this.xhr.restore.apply(this.xhr,arguments)}}}(),"undefined"!=typeof module&&module.exports&&(module.exports=sinon),function(){function a(){}a.prototype=sinon.fakeServer,sinon.fakeServerWithClock=new a,sinon.fakeServerWithClock.addRequest=function(a){if(a.async&&("object"==typeof setTimeout.clock?this.clock=setTimeout.clock:(this.clock=sinon.useFakeTimers(),this.resetClock=!0),!this.longestTimeout)){var b=this.clock.setTimeout,c=this.clock.setInterval,d=this;this.clock.setTimeout=function(a,c){return d.longestTimeout=Math.max(c,d.longestTimeout||0),b.apply(this,arguments)},this.clock.setInterval=function(a,b){return d.longestTimeout=Math.max(b,d.longestTimeout||0),c.apply(this,arguments)}}return sinon.fakeServer.addRequest.call(this,a)},sinon.fakeServerWithClock.respond=function(){var a=sinon.fakeServer.respond.apply(this,arguments);return this.clock&&(this.clock.tick(this.longestTimeout||0),this.longestTimeout=0,this.resetClock&&(this.clock.restore(),this.resetClock=!1)),a},sinon.fakeServerWithClock.restore=function(){return this.clock&&this.clock.restore(),sinon.fakeServer.restore.apply(this,arguments)}}(),"undefined"!=typeof module&&module.exports){var sinon=require("../sinon");sinon.extend(sinon,require("./util/fake_timers"))}return function(){function a(a,b,d,e){e&&(!b.injectInto||d in b.injectInto?c.call(a.args,e):(b.injectInto[d]=e,a.injectedKeys.push(d)))}function b(a){var b=sinon.create(sinon.sandbox);return a.useFakeServer&&("object"==typeof a.useFakeServer&&(b.serverPrototype=a.useFakeServer),b.useFakeServer()),a.useFakeTimers&&("object"==typeof a.useFakeTimers?b.useFakeTimers.apply(b,a.useFakeTimers):b.useFakeTimers()),b}var c=[].push;sinon.sandbox=sinon.extend(sinon.create(sinon.collection),{useFakeTimers:function(){return this.clock=sinon.useFakeTimers.apply(sinon,arguments),this.add(this.clock)},serverPrototype:sinon.fakeServer,useFakeServer:function(){var a=this.serverPrototype||sinon.fakeServer;return a&&a.create?(this.server=a.create(),this.add(this.server)):null},inject:function(a){return sinon.collection.inject.call(this,a),this.clock&&(a.clock=this.clock),this.server&&(a.server=this.server,a.requests=this.server.requests),a},restore:function(){sinon.collection.restore.apply(this,arguments),this.restoreContext()},restoreContext:function(){if(this.injectedKeys){for(var a=0,b=this.injectedKeys.length;b>a;a++)delete this.injectInto[this.injectedKeys[a]];this.injectedKeys=[]}},create:function(c){if(!c)return sinon.create(sinon.sandbox);var d=b(c);d.args=d.args||[],d.injectedKeys=[],d.injectInto=c.injectInto;var e,f,g=d.inject({});if(c.properties)for(var h=0,i=c.properties.length;i>h;h++)e=c.properties[h],f=g[e]||"sandbox"==e&&d,a(d,c,e,f);else a(d,c,"sandbox",f);return d}}),sinon.sandbox.useFakeXMLHttpRequest=sinon.sandbox.useFakeServer,"undefined"!=typeof module&&module.exports&&(module.exports=sinon.sandbox)
}(),function(a){function b(b){var c=typeof b;if("function"!=c)throw new TypeError("sinon.test needs to wrap a test function, got "+c);return function(){var c=a.getConfig(a.config);c.injectInto=c.injectIntoThis&&this||c.injectInto;var d,e,f=a.sandbox.create(c),g=Array.prototype.slice.call(arguments).concat(f.args);try{e=b.apply(this,g)}catch(h){d=h}if("undefined"!=typeof d)throw f.restore(),d;return f.verifyAndRestore(),e}}var c="undefined"!=typeof module&&module.exports;!a&&c&&(a=require("../sinon")),a&&(b.config={injectIntoThis:!0,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:!0,useFakeServer:!0},c?module.exports=b:a.test=b)}("object"==typeof sinon&&sinon||null),function(a){function b(a,b,c){return function(){b&&b.apply(this,arguments);var d,e;try{e=a.apply(this,arguments)}catch(f){d=f}if(c&&c.apply(this,arguments),d)throw d;return e}}function c(c,d){if(!c||"object"!=typeof c)throw new TypeError("sinon.testCase needs an object with test functions");d=d||"test";var e,f,g,h=new RegExp("^"+d),i={},j=c.setUp,k=c.tearDown;for(e in c)if(c.hasOwnProperty(e)){if(f=c[e],/^(setUp|tearDown)$/.test(e))continue;"function"==typeof f&&h.test(e)?(g=f,(j||k)&&(g=b(f,j,k)),i[e]=a.test(g)):i[e]=c[e]}return i}var d="undefined"!=typeof module&&module.exports;!a&&d&&(a=require("../sinon")),a&&Object.prototype.hasOwnProperty&&(d?module.exports=c:a.testCase=c)}("object"==typeof sinon&&sinon||null),function(a,b){function c(){for(var a,b=0,c=arguments.length;c>b;++b)a=arguments[b],a||g.fail("fake is not a spy"),"function"!=typeof a&&g.fail(a+" is not a function"),"function"!=typeof a.getCall&&g.fail(a+" is not stubbed")}function d(a,c){a=a||b;var d=a.fail||g.fail;d.call(a,c)}function e(a,b,e){2==arguments.length&&(e=b,b=a),g[a]=function(f){c(f);var h=i.call(arguments,1),j=!1;j="function"==typeof b?!b(f):"function"==typeof f[b]?!f[b].apply(f,h):!f[b],j?d(this,f.printf.apply(f,[e].concat(h))):g.pass(a)}}function f(a,b){return!a||/^fail/.test(b)?b:a+b.slice(0,1).toUpperCase()+b.slice(1)}var g,h="undefined"!=typeof module&&module.exports,i=Array.prototype.slice;!a&&h&&(a=require("../sinon")),a&&(g={failException:"AssertError",fail:function(a){var b=new Error(a);throw b.name=this.failException||g.failException,b},pass:function(){},callOrder:function(){c.apply(null,arguments);var b="",e="";if(a.calledInOrder(arguments))g.pass("callOrder");else{try{b=[].join.call(arguments,", ");for(var f=i.call(arguments),h=f.length;h;)f[--h].called||f.splice(h,1);e=a.orderByFirstCall(f).join(", ")}catch(j){}d(this,"expected "+b+" to be called in order but were called as "+e)}},callCount:function(b,e){if(c(b),b.callCount!=e){var f="expected %n to be called "+a.timesInWords(e)+" but was called %c%C";d(this,b.printf(f))}else g.pass("callCount")},expose:function(a,b){if(!a)throw new TypeError("target is null or undefined");var c=b||{},d="undefined"==typeof c.prefix&&"assert"||c.prefix,e="undefined"==typeof c.includeFail||!!c.includeFail;for(var g in this)"export"==g||!e&&/^(fail)/.test(g)||(a[f(d,g)]=this[g]);return a},match:function(b,c){var e=a.match(c);if(e.test(b))g.pass("match");else{var f=["expected value to match","    expected = "+a.format(c),"    actual = "+a.format(b)];d(this,f.join("\n"))}}},e("called","expected %n to have been called at least once but was never called"),e("notCalled",function(a){return!a.called},"expected %n to not have been called but was called %c%C"),e("calledOnce","expected %n to be called once but was called %c%C"),e("calledTwice","expected %n to be called twice but was called %c%C"),e("calledThrice","expected %n to be called thrice but was called %c%C"),e("calledOn","expected %n to be called with %1 as this but was called with %t"),e("alwaysCalledOn","expected %n to always be called with %1 as this but was called with %t"),e("calledWithNew","expected %n to be called with new"),e("alwaysCalledWithNew","expected %n to always be called with new"),e("calledWith","expected %n to be called with arguments %*%C"),e("calledWithMatch","expected %n to be called with match %*%C"),e("alwaysCalledWith","expected %n to always be called with arguments %*%C"),e("alwaysCalledWithMatch","expected %n to always be called with match %*%C"),e("calledWithExactly","expected %n to be called with exact arguments %*%C"),e("alwaysCalledWithExactly","expected %n to always be called with exact arguments %*%C"),e("neverCalledWith","expected %n to never be called with arguments %*%C"),e("neverCalledWithMatch","expected %n to never be called with match %*%C"),e("threw","%n did not throw exception%C"),e("alwaysThrew","%n did not always throw exception%C"),h?module.exports=g:a.assert=g)}("object"==typeof sinon&&sinon||null,"undefined"!=typeof window?window:"undefined"!=typeof self?self:global),sinon}.call("undefined"!=typeof window&&window||{}),window.fakeserver=new MockStormpath;